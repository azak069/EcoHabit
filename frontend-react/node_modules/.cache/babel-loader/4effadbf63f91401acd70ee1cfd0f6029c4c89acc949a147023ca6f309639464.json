{"ast":null,"code":"// src/services/api.js\nconst API_BASE_URL = process.env.REACT_APP_API_BASE_URL; // Menggunakan proxy di package.json\n\nexport function getToken() {\n  return localStorage.getItem('ecohabit_token');\n}\nexport function saveToken(token) {\n  localStorage.setItem('ecohabit_token', token);\n}\nexport function saveUser(user) {\n  localStorage.setItem('ecohabit_user', JSON.stringify(user));\n}\nexport function getUser() {\n  try {\n    return JSON.parse(localStorage.getItem('ecohabit_user'));\n  } catch (e) {\n    return null;\n  }\n}\nexport function clearAuthStorage() {\n  localStorage.removeItem('ecohabit_token');\n  localStorage.removeItem('ecohabit_user');\n}\n\n/**\n * Fungsi fetch terautentikasi\n * @param {string} url - URL API (tanpa /api)\n * @param {object} options - Opsi fetch (method, body, etc.)\n */\nexport async function authFetch(url, options = {}) {\n  const token = getToken();\n  const headers = {\n    'Content-Type': 'application/json',\n    ...options.headers\n  };\n  if (token) {\n    headers['Authorization'] = `Bearer ${token}`;\n  }\n  try {\n    const response = await fetch(`${API_BASE_URL}${url}`, {\n      ...options,\n      headers\n    });\n\n    // Handle 204 No Content\n    if (response.status === 204) {\n      return true;\n    }\n    const data = await response.json();\n    if (!response.ok) {\n      // Jika token expired/invalid, auto-logout\n      if (response.status === 401 && url !== '/auth/login') {\n        clearAuthStorage();\n        window.location.href = '/login';\n      }\n      throw new Error(data.message || 'Terjadi kesalahan pada server');\n    }\n    return data;\n  } catch (error) {\n    console.error('API Fetch Error:', error);\n    throw error; // Lempar ulang error agar bisa ditangkap oleh komponen\n  }\n}","map":{"version":3,"names":["API_BASE_URL","process","env","REACT_APP_API_BASE_URL","getToken","localStorage","getItem","saveToken","token","setItem","saveUser","user","JSON","stringify","getUser","parse","e","clearAuthStorage","removeItem","authFetch","url","options","headers","response","fetch","status","data","json","ok","window","location","href","Error","message","error","console"],"sources":["/home/oneclash/Dokumen/codingan/Test/EcoHabit/frontend-react/src/services/api.js"],"sourcesContent":["// src/services/api.js\nconst API_BASE_URL = process.env.REACT_APP_API_BASE_URL; // Menggunakan proxy di package.json\n\nexport function getToken() {\n  return localStorage.getItem('ecohabit_token');\n}\n\nexport function saveToken(token) {\n  localStorage.setItem('ecohabit_token', token);\n}\n\nexport function saveUser(user) {\n  localStorage.setItem('ecohabit_user', JSON.stringify(user));\n}\n\nexport function getUser() {\n    try {\n        return JSON.parse(localStorage.getItem('ecohabit_user'));\n    } catch (e) {\n        return null;\n    }\n}\n\nexport function clearAuthStorage() {\n  localStorage.removeItem('ecohabit_token');\n  localStorage.removeItem('ecohabit_user');\n}\n\n/**\n * Fungsi fetch terautentikasi\n * @param {string} url - URL API (tanpa /api)\n * @param {object} options - Opsi fetch (method, body, etc.)\n */\nexport async function authFetch(url, options = {}) {\n  const token = getToken();\n  const headers = {\n    'Content-Type': 'application/json',\n    ...options.headers,\n  };\n\n  if (token) {\n    headers['Authorization'] = `Bearer ${token}`;\n  }\n\n  try {\n    const response = await fetch(`${API_BASE_URL}${url}`, { ...options, headers });\n\n    // Handle 204 No Content\n    if (response.status === 204) {\n      return true;\n    }\n\n    const data = await response.json();\n\n    if (!response.ok) {\n      // Jika token expired/invalid, auto-logout\n      if (response.status === 401 && url !== '/auth/login') {\n         clearAuthStorage();\n         window.location.href = '/login';\n      }\n      throw new Error(data.message || 'Terjadi kesalahan pada server');\n    }\n\n    return data;\n  } catch (error) {\n    console.error('API Fetch Error:', error);\n    throw error; // Lempar ulang error agar bisa ditangkap oleh komponen\n  }\n}"],"mappings":"AAAA;AACA,MAAMA,YAAY,GAAGC,OAAO,CAACC,GAAG,CAACC,sBAAsB,CAAC,CAAC;;AAEzD,OAAO,SAASC,QAAQA,CAAA,EAAG;EACzB,OAAOC,YAAY,CAACC,OAAO,CAAC,gBAAgB,CAAC;AAC/C;AAEA,OAAO,SAASC,SAASA,CAACC,KAAK,EAAE;EAC/BH,YAAY,CAACI,OAAO,CAAC,gBAAgB,EAAED,KAAK,CAAC;AAC/C;AAEA,OAAO,SAASE,QAAQA,CAACC,IAAI,EAAE;EAC7BN,YAAY,CAACI,OAAO,CAAC,eAAe,EAAEG,IAAI,CAACC,SAAS,CAACF,IAAI,CAAC,CAAC;AAC7D;AAEA,OAAO,SAASG,OAAOA,CAAA,EAAG;EACtB,IAAI;IACA,OAAOF,IAAI,CAACG,KAAK,CAACV,YAAY,CAACC,OAAO,CAAC,eAAe,CAAC,CAAC;EAC5D,CAAC,CAAC,OAAOU,CAAC,EAAE;IACR,OAAO,IAAI;EACf;AACJ;AAEA,OAAO,SAASC,gBAAgBA,CAAA,EAAG;EACjCZ,YAAY,CAACa,UAAU,CAAC,gBAAgB,CAAC;EACzCb,YAAY,CAACa,UAAU,CAAC,eAAe,CAAC;AAC1C;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO,eAAeC,SAASA,CAACC,GAAG,EAAEC,OAAO,GAAG,CAAC,CAAC,EAAE;EACjD,MAAMb,KAAK,GAAGJ,QAAQ,CAAC,CAAC;EACxB,MAAMkB,OAAO,GAAG;IACd,cAAc,EAAE,kBAAkB;IAClC,GAAGD,OAAO,CAACC;EACb,CAAC;EAED,IAAId,KAAK,EAAE;IACTc,OAAO,CAAC,eAAe,CAAC,GAAG,UAAUd,KAAK,EAAE;EAC9C;EAEA,IAAI;IACF,MAAMe,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAGxB,YAAY,GAAGoB,GAAG,EAAE,EAAE;MAAE,GAAGC,OAAO;MAAEC;IAAQ,CAAC,CAAC;;IAE9E;IACA,IAAIC,QAAQ,CAACE,MAAM,KAAK,GAAG,EAAE;MAC3B,OAAO,IAAI;IACb;IAEA,MAAMC,IAAI,GAAG,MAAMH,QAAQ,CAACI,IAAI,CAAC,CAAC;IAElC,IAAI,CAACJ,QAAQ,CAACK,EAAE,EAAE;MAChB;MACA,IAAIL,QAAQ,CAACE,MAAM,KAAK,GAAG,IAAIL,GAAG,KAAK,aAAa,EAAE;QACnDH,gBAAgB,CAAC,CAAC;QAClBY,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,QAAQ;MAClC;MACA,MAAM,IAAIC,KAAK,CAACN,IAAI,CAACO,OAAO,IAAI,+BAA+B,CAAC;IAClE;IAEA,OAAOP,IAAI;EACb,CAAC,CAAC,OAAOQ,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,kBAAkB,EAAEA,KAAK,CAAC;IACxC,MAAMA,KAAK,CAAC,CAAC;EACf;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}